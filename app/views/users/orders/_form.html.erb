<%= form_with(model: order, url: url, data: { controller: 'nested-form', nested_form_wrapper_selector_value: '.nested-form-wrapper' }) do |form| %>
  <% if order.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(order.errors.count, "error") %> prohibited this order from being saved:</h2>

      <ul>
        <% order.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>


  <div class="card mb-3">
    <div class="bg-holder d-none d-lg-block bg-card" style="background-image:url(<%= image_path('theme/corner-4.png') %>);opacity: 0.7;">
    </div>
    <!--/.bg-holder-->

    <div class="card-body position-relative">
      <h5>Order Details: #2737</h5>
      <p class="fs-10">April 21, 2019, 5:33 PM</p>
      <div><strong class="me-2">Status: </strong>
        <div class="badge rounded-pill badge-subtle-success fs-11">Completed<span class="fas fa-check ms-1" data-fa-transform="shrink-2"></span></div>
      </div>
    </div>
  </div>
  <div class="card mb-3">
    <div class="card-body">
      <div class="row">
        <div class="col-md-6 col-lg-4 mb-4 mb-lg-0">
          <h5 class="mb-3 fs-9">Billing Address</h5>
          <h6 class="mb-2">Antony Hopkins</h6>
          <p class="mb-1 fs-10">2393 Main Avenue<br />Penasauka, New Jersey 87896</p>
          <p class="mb-0 fs-10"> <strong>Email: </strong><a href="mailto:ricky@gmail.com">antony@example.com</a></p>
          <p class="mb-0 fs-10"> <strong>Phone: </strong><a href="tel:7897987987">7897987987</a></p>
        </div>
        <div class="col-md-6 col-lg-4 mb-4 mb-lg-0">
          <h5 class="mb-3 fs-9">Shipping Address</h5>
          <h6 class="mb-2">Antony Hopkins</h6>
          <p class="mb-0 fs-10">2393 Main Avenue<br />Penasauka, New Jersey 87896</p>
          <div class="text-500 fs-10">(Free Shipping)</div>
        </div>
        <div class="col-md-6 col-lg-4">
          <h5 class="mb-3 fs-9">Payment Method</h5>
          <div class="d-flex"><img class="me-3" src="<%= image_path 'theme/visa.png' %>" width="40" height="30" alt="" />
            <div class="flex-1">
              <h6 class="mb-0">Antony Hopkins</h6>
              <p class="mb-0 fs-10">**** **** **** 9809</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <template data-nested-form-target="template">
    <%= form.fields_for :order_products, order.order_products.build(price_cents: 0, final_price_cents: 0, quantity: 1), child_index: 'NEW_RECORD' do |order_product_fields| %>
      <%= render "order_product_form", f: order_product_fields %>
    <% end %>
  </template>

  <div class="card mb-3">
    <div class="card-body">
      <div class="table-responsive fs-10">
        <table class="table table-striped border-bottom">
          <thead class="bg-200">
            <tr>
              <th class="text-900 border-0">Products</th>
              <th class="text-900 border-0 text-center">Quantity</th>
              <th class="text-900 border-0 text-center">Rate</th>
              <th class="text-900 border-0 text-center">Amount</th>
              <th class="text-900 border-0 text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            <%= form.fields_for :order_products do |order_product_fields| %>
              <%= render "order_product_form", f: order_product_fields %>
            <% end %>

            <!-- Inserted elements will be injected before that target. -->
            <tr data-nested-form-target="target"></tr>
            <tr>
              <td colspan="5">
                <button type="button" data-action="nested-form#add" class="btn btn-primary">Add Product</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="row g-0 justify-content-end">
        <div class="col-auto">
          <table class="table table-sm table-borderless fs-10 text-end">
            <tr>
              <th class="text-900">Subtotal:</th>
              <td class="fw-semi-bold">$<%= form.number_field :price, class: 'form-control' %></td>
            </tr>
            <tr>
              <th class="text-900">Tax 5%:</th>
              <td class="fw-semi-bold">$311.50</td>
            </tr>
            <tr class="border-top">
              <th class="text-900">Total:</th>
              <td class="fw-semi-bold">$6541.50</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div>
    <%= form.submit %>
  </div>
<% end %>
